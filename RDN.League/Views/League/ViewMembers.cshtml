@model RDN.League.Models.OutModel.GenericSingleModel<RDN.League.Models.Utilities.SimpleModPager<RDN.Portable.Classes.Account.Classes.MemberDisplay>>
@{
    ViewBag.Title = "View Members for " + ViewBag.LeagueName;
    Layout = "~/Views/Shared/_Layout.cshtml";
    
    var memId = RDN.Library.Classes.Account.User.GetMemberId();
    bool isAdminOfLeague = RDN.Library.Cache.MemberCache.IsSecretaryOrBetterOfLeague(memId);
    bool isPaid = RDN.Library.Cache.MemberCache.CheckIsLeagueSubscriptionPaid(memId);
}


<ol class="breadcrumb">
    <li><a href="@RDN.Utilities.Config.ConfigManager.InternalSite">Home</a></li>
    <li class="active">Members</li>
</ol>


<div class="panel panel-default margin-top-20">
    <div class="panel-heading">
        <div class="row">
            <div class="col-xs-6">
                <h3 style="margin-top:5px !important"><i class="fa fa-group"></i> Members For @ViewBag.LeagueName</h3>
            </div>
            <div class="col-xs-6 text-right no-padding-top">
               @if (isAdminOfLeague)
                {
                    <a class="btn btn-info btn-sm margin-top-5" title="Add Members" href="@Url.Content("~/League/Members/Add")">
                        <i class="fa fa-plus-circle"></i> Add
                    </a>
                    <button class="btn btn-default btn-sm margin-top-5" onclick="document.getElementById('MembersReport').submit();" title="Export Roster">
                        <i class="fa fa-download"></i> Export
                    </button>
                }

                @if (isPaid)
                {
                    <a class="btn btn-default btn-sm margin-top-5" href="@Url.Content("~/league/members/view/report")">
                        <i class="fa fa-file-text"></i> Report
                    </a>
                }
                else
                {
                    <a class="btn btn-default btn-sm margin-top-5" href="@Url.Content("~/billing/league/" + ViewBag.LeagueId + "?u=" + RDN.Library.Util.Enum.SiteMessagesEnum.pp)" title="Report Builder is only available to subscribed leagues">
                        <i class="fa fa-file"></i> Report
                    </a>
                }
            </div>
        </div>
        <div class="text-muted margin-top-5"> Contacts are a way to keep in touch with anyone of interest.  Volunteers, Sponsors, Officials and any other person you might need to contact.</div>
    </div>
    <div class="panel-heading text-center no-padding-bottom" style="background-color:#fbfbfb">
        @Html.Partial("Menus/LeagueViewMembers")
    </div>
    <div class="panel-body">
        @if (Model.Model.Items.Count < 10)
        {
            <div>
                <span class="b">League Join Code</span> - <span>'@ViewBag.JoinCode'</span> - You
                can give this code to members who have signed up to RDNation, but have not been
                connected to your league. This will attach the member who uses this code to your
                league, so only give it to members you manage.
            </div>
        }
        <table class="table table-striped table-hover table-condensed" id="members">
            <thead>
                <tr>
                    <th></th>
                    <th>
                        Derby Name
                    </th>
                    <th>
                        #
                    </th>
                    <th>
                        Name
                    </th>
                    <th>
                        Phone Number
                    </th>
                    <th>
                        Email
                    </th>
                    <th class="center">
                        Inactive
                    </th>
                    <th class="center">
                        SMS
                    </th>
                    @if (isAdminOfLeague)
                    {
                        <th></th>
                    }
                    <th class="center">
                    </th>

                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.Model.Items.Count; i++)
                {

                    <tr>
                        <td>
                        </td>
                        <td>
                            <a target="_blank" href="@Url.Content("~/Member/" + Model.Model.Items[i].MemberId.ToString().Replace("-", "") + "/" + RDN.Utilities.Strings.StringExt.ToSearchEngineFriendly(Model.Model.Items[i].DerbyName))">
                                @Model.Model.Items[i].DerbyName
                            </a>
                        </td>
                        <td>
                            @Model.Model.Items[i].PlayerNumber
                        </td>
                        <td>
                            @if (Model.Model.Items[i].Gender == RDN.Portable.Classes.Account.Enums.GenderEnum.Female)
                            {
                                <i class="fa fa-female fa-lg" style="color:silver"></i>
                            }
                            else if (Model.Model.Items[i].Gender == RDN.Portable.Classes.Account.Enums.GenderEnum.Male)
                            {
                                <i class="fa fa-male fa-lg" style="color:silver"></i>
                            }<span>&nbsp;&nbsp;</span>
                            @Model.Model.Items[i].Firstname @Model.Model.Items[i].LastName
                        </td>
                        <td>
                            @if (isAdminOfLeague || !Model.Model.Items[i].Settings.Hide_Phone_Number_From_League || Model.Model.Items[i].MemberId == memId)
                            {
                                @Model.Model.Items[i].PhoneNumber
                            }
                        </td>
                        <td>
                            @if (isAdminOfLeague || !Model.Model.Items[i].Settings.Hide_Email_From_League || Model.Model.Items[i].MemberId == memId)
                            {
                                @Model.Model.Items[i].Email
                            }
                        </td>
                        <td class="text-center">
                            @if (Model.Model.Items[i].IsInactiveFromCurrentLeague)
                            {
                                <img src="@Url.Content("~/Content/images/greenCheck.png")" />
                            }
                        </td>
                        <td class="text-center">
                            @if (!Model.Model.Items[i].IsCarrierVerified && Model.Model.Items[i].MemberId == memId)
                            {
                                <a href="@Url.Content("~/member/settings")">Setup</a>
                            }
                            else if (Model.Model.Items[i].IsCarrierVerified)
                            {
                                <img src="@Url.Content("~/Content/images/greenCheck.png")" />
                            }
                        </td>
                        @if (isAdminOfLeague)
                        {
                            <td>
                                <a class="btn btn-xs btn-success" href="@Url.Content("~/League/Member/Edit/" + Model.Model.Items[i].MemberId.ToString().Replace("-", "") + "/" + RDN.Utilities.Strings.StringExt.ToSearchEngineFriendly(Model.Model.Items[i].DerbyName))"> <i class="fa fa-pencil"></i> </a>
                            </td>
                        }
                        <td id="@Model.Model.Items[i].MemberId-connected" class="center">
                            @if (!Model.Model.Items[i].IsConnected && isAdminOfLeague)
                            {
                                <input class="btn btn-xs btn-warning" id="@Model.Model.Items[i].MemberId-invite" type="button" value="Invite" onclick="SendEmailInviteToRDNation('@Model.Model.Items[i].MemberId', '@ViewBag.LeagueName')" />
                            }
                        </td>

                    </tr>

                }
            </tbody>
            
        </table>
    </div>
    <div class="panel-footer">
        @if (Model.Model.Items.Count > 10)
        {
            <div>
                <span class="b">League Join Code</span> - <span>'@ViewBag.JoinCode'</span> <a onclick="return confirm('Really Want To Refresh?')" class="btn btn-xs btn-default" href="JavaScript:joinCode()" title="Refresh To Generate New Join Code?"><i class="fa fa-refresh"></i> Refresh</a> 
                <br />
                You can give this code to members who have signed up to RDNation, but have not been
                connected to your league. This will attach the member who uses this code to your
                league, so only give it to members you manage.
            </div>
             <div>
                <span class="b">SMS</span> - Can send user Text Messages through the messages Menu.<br />
                <span class="b">Joined</span> - Shows who is signed up and who isn't. So you
                can make sure they get setup with <a href="rdnation.com">RDNation.com</a>.
            </div>
        }
    </div>
</div>
@using (Html.BeginForm("ExportMembersRoster", "League", FormMethod.Post, new { @id = "MembersReport" }))
{

}
  
    <script type="text/javascript">
        $(document).ready(function () {
            $("#membersTypeButtons").find("li[tag='roster']").addClass('active b');
            $('#members').dataTable({
                "aaSorting": [[1, "asc"]],
                "bPaginate": false,
                "bLengthChange": false,
                "bFilter": true,
                "bSort": true,
                "bInfo": false,
                "oLanguage": { "sSearch": "" },
                "bAutoWidth": false,
                "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                    $("td:first", nRow).html(iDisplayIndex + 1);
                    return nRow;
                },
            });
            $('#members_filter input').addClass('form-control').attr("placeholder", "Search");
            
        });
    
    </script>
