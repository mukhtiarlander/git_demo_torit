@using RDN.League.Models.Messages
@using RDN.Library.Cache
@model MessageModel
@{
    ViewBag.Title = "Create New Message";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<ol class="breadcrumb">
    <li><a href="@RDN.Utilities.Config.ConfigManager.InternalSite">Home</a></li>
    <li><a href="@Url.Content("~/messages/" + RDN.Portable.Classes.Controls.Message.Enums.GroupOwnerTypeEnum.member + "/" + RDN.Library.Classes.Account.User.GetMemberId().ToString().Replace("-", ""))">Messages</a></li>
    <li class="active">Send New Private Message</li>
</ol>

<div class="row">
    <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="margin-bottom-10 margin-top-5"><i class="fa fa-comment-o"></i> Send New Private Message</h3>
                <span class="text-muted">
                    You can send a message to anyone within @RDN.Library.Classes.Config.LibraryConfig.WebsiteShortName by just typing their name into
                    the "To Additional Members Field" or just select their name from the list on the
                    left.
                    @if (!Model.IsCarrierVerified)
                    {
                        <span><a href="@Url.Content("~/member/settings")">Verify Your Phone Number Now</a></span>
                    }
                </span>
            </div>
            @using (Html.BeginForm("CreateNewMessage", "Message", FormMethod.Post, new { onsubmit = "Messages.SaveRecipientListToForm()" }))
            {
                <div class="panel-body">

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="form-label margin-bottom-5">
                                <label class="form-label margin-top-10">
                                    Members and Groups
                                </label>

                            </div>
                            <div class="input-group margin-bottom-5">
                                @Html.TextBoxFor(x => x.ToMemberNames, new { @class = "form-control full-width" })
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-warning pull-right" onclick="Messages.ShowNewPrivateMessageMembersPopup()"><i class="fa fa-check-square-o"></i> Select</button>
                                </span>
                                @Html.HiddenFor(x => x.ToMemberIds)
                            </div>

                            <div class="form-label margin-bottom-5">
                                Title
                            </div>
                            <div class="margin-bottom-10">
                                @Html.TextBoxFor(x => x.Title, new { @class = "form-control" })
                            </div>
                            <div class="form-label margin-bottom-5">
                                Message
                            </div>
                            <div class="margin-bottom-10">
                                @Html.TextArea("MessageTextWriting", new { rows = "2", style = "height:60px;width:100%", @class = "form-control" })
                            </div>
                            <label>
                                @Html.CheckBoxFor(x => x.SendEmailForMessage) <span class="i">
                                    Notifies the member via
                                    email of the new message. (recommended)
                                </span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="panel-footer">
                    <button class="btn btn-sm btn-success" type="submit"><i class="fa fa-envelope-o"></i> Send Text</button>
                    <a class="btn btn-sm btn-default" href="@Url.Content("~/messages/" + Model.OwnerType.ToString() + "/" + Model.OwnerId.ToString().Replace("-", ""))">Cancel Message</a>
                </div>

                @Html.HiddenFor(x => x.OwnerType)
                @Html.HiddenFor(x => x.OwnerId)
                <div class="modal fade" id="NewPrivateMessageMembersPopup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title"><i class="fa fa-check-square-o"></i> Known Recipients</h4>
                                <span class="text-muted">This list is people you are connected to within @RDN.Library.Classes.Config.LibraryConfig.WebsiteShortName.</span>
                            </div>
                            <div class="modal-body padding-10">
                                @if (Model.Groups.Count > 0)
                                {
                                    <div class="text-right">
                                        <label class="margin-left-10" style="font-weight:normal">
                                            <input type="checkbox" onchange="Messages.ToggleCheckedAllForGroups(this)" id="checkAll" />
                                            Select All
                                        </label>
                                    </div>
                                    <div id="groupCheckBoxes" class="row panel panel-default no-margin padding-top-10" style="max-height:300px; overflow-y:auto">
                                        @foreach (var group in Model.Groups)
                                        {
                                            <div class="col-xs-12 col-sm-6">
                                                <label class="no-bold">
                                                    @Html.CheckBox(group.Id.ToString(), new { @derbyname = group.GroupName, @onchange = "Messages.SelectRecipient(this, '" + group.Id + "','" + group.GroupName + "')" })<span id="@group.Id.ToString()-name">
                                                        @group.GroupName
                                                    </span>
                                                </label>
                                            </div>
                                        }
                                    </div>
                                }
                                <div class="text-right">
                                    <label class="margin-left-10" style="font-weight:normal">
                                        <input type="checkbox" id="checkAllMembers" onchange="Messages.ToggleCheckedAllForRecipients(this)" />
                                        Select All
                                    </label>
                                </div>
                                <div id="checkboxesForMembers" class="row panel panel-default no-margin padding-top-10" style="max-height:300px; overflow-y:auto">
                                    @foreach (var mem in Model.Recipients)
                                    {
                                        <div class="col-xs-12 col-sm-6">
                                            <label class="no-bold">
                                                                                                 @Html.CheckBox(mem.MemberId.ToString(), new { @class = "cbm", @derbyname = mem.SiteName, @onchange = "Messages.SelectRecipient(this, '" + mem.MemberId + "','" + mem.SiteName + "')" })
                                                                                                <span id="@mem.MemberId.ToString()-name">
                                                    @mem.SiteName
                                                </span>

                                            </label>
                                        </div>
                                    }
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" data-dismiss="modal" class="btn btn-primary btn-sm"><i class="fa fa-check"></i> Done</button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@if (Model.OwnerType == RDN.Portable.Classes.Controls.Message.Enums.GroupOwnerTypeEnum.officiating || Model.OwnerType == RDN.Portable.Classes.Controls.Message.Enums.GroupOwnerTypeEnum.league || Model.OwnerType == RDN.Portable.Classes.Controls.Message.Enums.GroupOwnerTypeEnum.jobboard || Model.OwnerType == RDN.Portable.Classes.Controls.Message.Enums.GroupOwnerTypeEnum.shop || Model.OwnerType == RDN.Portable.Classes.Controls.Message.Enums.GroupOwnerTypeEnum.paywall || Model.OwnerType == RDN.Portable.Classes.Controls.Message.Enums.GroupOwnerTypeEnum.calevent)
{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#checkAll").attr("checked", "checked");
            Messages.ToggleCheckedAllForRecipients($("#checkAll"));
        });
    </script>
}
<script type="text/javascript">
    $(document).ready(function () {
        var memberId = "@Model.OwnerId.ToString().Replace("-","")";
        var type = "@Model.OwnerType.ToString()";
        Messages.SetupNewMessage(memberId, type);

    });
</script>